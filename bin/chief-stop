#!/usr/bin/env bash
# Stop all workers

PROJECT_DIR="$(pwd)"
RALPH_DIR="$PROJECT_DIR/.ralph"

if [ ! -f "$RALPH_DIR/.chief.pid" ]; then
    echo "No chief process running"
    exit 0
fi

echo "Stopping all workers..."

stopped_count=0
while read -r pid; do
    if kill -0 "$pid" 2>/dev/null; then
        echo "Stopping PID $pid"
        kill -TERM "$pid"
        ((stopped_count++))
    fi
done < "$RALPH_DIR/.chief.pid"

rm "$RALPH_DIR/.chief.pid"
echo "Stopped $stopped_count workers"
